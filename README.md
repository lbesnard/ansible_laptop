# ğŸ›¸ Homelab Infrastructure

This repository is the central nervous system for my homelab and laptop provisioning. It manages the lifecycle of Proxmox VMs through a "Define once, Deploy anywhere" workflow.

# ğŸ“‚ Repository Architecture
```
.
â”œâ”€â”€ terraform/                
â”‚   â”œâ”€â”€ brownfunk/            # Hardware definition for the main cluster
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â””â”€â”€ variables.tf
â”‚   â”œâ”€â”€ myNewNode/            # Sandbox/Secondary node definitions
â”‚   â””â”€â”€ [Go to Terraform Docs](./terraform/README.md)
â”‚
â”œâ”€â”€ ansible/                  
â”‚   â”œâ”€â”€ inventory/            # Host definitions
â”‚   â”‚   â”œâ”€â”€ brownfunk.ini     # Generated by TF (Main fleet)
â”‚   â”‚   â””â”€â”€ myNewNode.ini     # Generated by TF (Experimental nodes)
â”‚   â”œâ”€â”€ collections/          # Local Ansible modules (Git ignored)
â”‚   â”œâ”€â”€ tasks/                # Reusable logic (Docker, LUKS, etc.)
â”‚   â””â”€â”€ [Go to Ansible Docs](./ansible/README.md)
â”‚
â”œâ”€â”€ terraform.tfvars          # Global Secrets & API Keys (Git ignored)
â””â”€â”€ .gitignore                # Protects state, inventory, and secreto
```

# ğŸš€ Quick Start

## 1. Provision Hardware

Navigate to the specific node folder in Terraform. Applying this will trigger the provider to build the VM and use the `.tftpl` to write the `.ini` file into the Ansible inventory folder.

```bash
cd terraform/brownfunk
terraform init
terraform apply
```

---

## 2. Prepare Ansible Environment

Ensure the local collections are installed into the project (required once, or whenever `requirements.yml` changes).

```bash
cd ../../ansible
ansible-galaxy collection install -r requirements.yml -p ./collections
```

---

## 3. Run Configuration

Execute the playbook against the specific inventory generated in step 1.

```bash
ansible-playbook -i inventory/brownfunk.ini setup_homelabs.yml --ask-vault-pass # or generate a .vault_pass file
```

---

## ğŸ› ï¸ Management Commands

### Proxmox (Terraform)

| Command                          | Result                                      |
|----------------------------------|---------------------------------------------|
| `terraform plan`                 | Check what hardware changes are pending     |
| `terraform refresh`              | Sync local state with actual Proxmox status |
| `terraform apply -compact-warnings` | Clean output during VM creation          |

### Configuration (Ansible)

| Command                                                     | Result                                |
|-------------------------------------------------------------|---------------------------------------|
| `ansible-inventory -i inventory/brownfunk.ini --list`       | Debug the generated host groups       |
| `ansible-playbook ... --limit "bf-nas*"`                    | Only run tasks on the NAS node        |

