# user specific
- hosts: all
  gather_facts: true
  vars_files:
    - vars.yml
  ignore_errors: yes
  roles:
    - role: evandam.conda
  vars:
    # Uses inventory variable, falls back to the system user
    real_user: "{{ target_user | default(ansible_user_id) }}"

  tasks:
    # --- GROUP 1: THE UNIVERSAL BASE (Everyone) ---
    - name: "Universal: Core Dev Environment"
      include_tasks: "tasks/{{ item }}.yml"
      loop:
        - dotfiles
        - homebrew_packages
        - neovim
        - miniforge_packages
        - cheat
        - aodn_chef
        - data_services
        - fonts
        - github_repos
      tags: ['universal', 'remote', 'core']

    # --- GROUP 2: LAPTOP ONLY (Desktop Apps) ---
    - name: "Laptop Only: GUI Services"
      include_tasks: "tasks/{{ item }}.yml"
      loop:
        - nextcloud
        - mobac
      # Strictly limit to the laptop group
      when: "'laptop' in group_names"
      tags: ['heavy', 'laptop_only']


